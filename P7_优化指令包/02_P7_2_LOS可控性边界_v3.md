# P7.2 LOS 可控性边界（v3：自适应预瞄 Adaptive Lookahead）
**目标**：把“提前转向/平滑内切 → kappa_LOS 更小 → v_cap 更大”写成硬耦合。  
**依赖**：P7.0（必须有真实 heading）。

## 1) LOS cap（基础）
- `alpha = atan2(p_LA.y-pos.y, p_LA.x-pos.x)`
- `delta = wrap_to_pi(alpha - heading)`
- `d_LA = ||p_LA - pos||`
- `kappa_LOS = |delta| / (d_LA + eps)`
- `v_cap = MAX_ANG_VEL / (kappa_LOS + eps)`
- `v_ratio_cap = clip(v_cap / MAX_VEL, 0, 1)`

## 2) 自适应预瞄（推荐必须做）
目标预瞄距离：
- `d_target = d0 + k * v_exec`
- `d_target = clip(d_target, d_min, d_max)`

实现 A（推荐）：从候选 lookahead 点中选 `d_i` 最接近 `d_target` 的那个点计算 cap。  
实现 B（更强）：多预瞄 minimax（取最严格 kappa）。

建议起始参数：
- `d0` 与 `dt*MAX_VEL` 同量级
- `k` 让速度越快看得越远
- `d_max` 避免过远噪声

## 3) 自验证（tools/accept_p7_2_*.py）
- Line：cap 放开（p50≥0.95）
- Square：cap 弯前提前下压
- 速度一致性：高速时 d_target 更大、cap 下压更早
- 内切贡献：更早转向 → kappa_LOS 更小 → cap 更高（差值可观）
- 全程无 NaN/Inf
