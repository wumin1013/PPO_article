# P7.1 走廊奖励重构（v3：回中滞回 + 线性 ramp）
**目标**：走廊内自选幅度；出弯回中稳定不震荡。

## 1) 走廊内 reward 结构（不再追 |e_n-e_target|）
- 越界罚：`-w_out * outside_dist^2`（可 done）
- 势垒：`-w_bar*exp(-margin/s)` 或 `-w_bar/(margin+eps)`
- 内切偏好：`+w_in*tanh(turn_sign*e_n/corridor_half)`（弱引导、幅度自由）

## 2) 出弯回中必须线性 ramp（防震荡）
- 设 `exit_timer=0..N`
- `w_center = w_center_max * clip(exit_timer/N,0,1)`（线性上升）
- `r_center = -w_center*|e_n|`（或 -e_n^2）
N 推荐 50~200 步（按 dt/速度）

## 3) corner_phase 判定加滞回（hysteresis）
避免相位抖动：进入阈值 th_on，退出阈值 th_off<th_on。  
metric 可用 `kappa_LOS` 或 `|delta|` 等。

## 4) 自验证（tools/accept_p7_1_*.py）
- corner 内 e_n 不钉死：std(e_n) ≥ 0.1*corridor_half；方向正确比例≥0.8
- 出弯回中：N 步内 median(|e_n|) ≤ 0.2*corridor_half，且不过度震荡
- 相位抖动：corner_phase toggle 次数每回合 < 3
- 无 NaN/Inf
