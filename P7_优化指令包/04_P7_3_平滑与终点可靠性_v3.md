# P7.3 平滑与终点可靠性（v3：奇异点保护 + stall 联动 cap）
**目标**：曲率连续、无 NaN、stall 不误杀、success 稳。

## 1) 曲率奇异点保护（必须）
- `kappa = |omega_exec| / (v_exec + v_eps)`
推荐：
- `v_eps = 1e-6 * MAX_VEL`（按单位缩放）
或阈值法：
- `if v_exec < v_thr: kappa = 0`

> 不允许出现 Inf/NaN，否则 PPO 训练会崩。

平滑项：
- `-w_kappa*kappa^2`
- `-w_dkappa*(kappa-kappa_prev)^2`

## 2) stall 与 corner_phase/cap 联动
- corner_phase 内不触发或放宽 stall
- cap 低时不以低速判 stall（只看 progress）

## 3) success 判据增强（open path）
- 跨终点线触发 + 备用条件：`progress>0.995 && end_distance<half_epsilon`
- 终点 bonus 建议 +200 量级（按 time penalty 调整）

## 4) 自验证（tools/accept_p7_3_*.py）
输出并保存：
- kappa/dkappa 统计（max/p95）
- nan_count
- success/stall/oob
并画：kappa 曲线 + 轨迹图（拐角圆滑）
