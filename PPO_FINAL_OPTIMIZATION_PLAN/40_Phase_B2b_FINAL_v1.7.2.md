# Phase B2b：出弯回线 + 软约束（FINAL v1.7.2）
版本日期：2025-12-30  
依赖：B2a 已通过（至少在少量 seed 上趋势成立）。

---

## 1) B2b 目标

### A1 归档要求（本阶段强制）

- **本阶段每一次 run（训练 / 评估 / 消融），无论 PASS/FAIL，都必须按 A1 归档规范生成 Run Bundle（Level-2）。**
- PASS 的前提：该 run 已形成完整 Run Bundle，且 summary.verdict=PASS。  
  （换句话说：没有归档，就不存在“通过”。）
- 失败 run 也必须归档：这是定位退化/漂移/偶发性的唯一可靠证据链。

在 B2a 的基础上，把你遇到的典型失败形态（例如“出弯慢漂导致越界/到不了终点”）系统化解决：

- 出弯阶段能快速回到容许带中心附近（恢复贴线能力）
- 不靠过度降速换稳定（否则 B2a 的贡献会被稀释）
- 仍然保持拐角段平滑性改善

---

## 2) 你要解决的现象应该如何被“可观测化”
B2b 的本质不是加更多规则，而是把“出弯恢复”变成可度量对象：

建议至少记录并在 Run Bundle 中可计算：
- 出弯窗口定义（corner_mask 的后沿 + 若干步）
- 出弯恢复时间：误差回到带内（或回到某阈值）所需步数
- 出弯阶段的速度恢复曲线（v(t)）与角速度变化（ω(t)）

这些都可以从 trace 计算，优先走 Observability 路线。

---

## 3) 软约束（Soft constraints）的边界
你希望“充分发挥 RL”，因此 B2b 允许你引入软约束，但必须满足：

- 软约束应以 reward/aux loss 形式出现（Shaping），避免把策略空间写死
- 若必须引入 Hard-impact（例如某个安全包络），必须：
  - 可开关（默认不改变旧行为）
  - 参数与启用状态写入 manifest
  - 在论文中明确它是“安全约束”，不是学习贡献

---

## 4) B2b 的 PASS/FAIL
PASS：
- 必须项不退化（相对 baseline_ref）
- 出弯恢复指标显著改善（恢复更快、越界更少）
- 平滑性指标保持 B2a 水平或继续提升

FAIL：
- 通过“全程降速”获得稳定（效率退化）
- 或通过强硬规则把策略空间锁死（论文贡献会被质疑）

