# PPO 轨迹平滑优化实施计划

## 当前问题与目标

| 待解决问题 | 症状描述 | 解决方案 |
|-----------|----------|----------|
| **拐角尖角化** | 拐角处航向突变，未实现圆弧过渡 | P1: LOS 前瞻 + Deadzone |
| **全程速度偏低** | 执行速度远未达到 $v_{\max}$ | P3: 速度正激励 |

---

## 优化路径总览

```mermaid
flowchart LR
    P0[P0 残差控制<br/>✅ 已通过] --> P1[P1 LOS+Deadzone<br/>解决拐角尖角]
    P1 --> P2[P2 出弯回线<br/>+速度软约束]
    P2 --> P3[P3 速度激励<br/>解决速度偏低]
    P3 --> DONE[目标达成]
```

---

## P1: LOS 前瞻与 Deadzone

**目标**：解决拐角尖角问题

| 机制 | 作用 |
|------|------|
| 动态前瞻 $L(v)$ | 速度越大前瞻越远，自然圆弧化 |
| Deadzone | 直线严格，拐角允许切角 |
| 角加速度惩罚 | 迫使转向摊开 |

**文档**: [P1_v4.1_LOS前瞻与deadzone_ZeroActionSmoke_pythoncmd.md](file:///c:/Users/wumin/Nutstore/1/DDPG的轨迹平滑/基于强化学习的轨迹平滑/P1_v4.1_LOS前瞻与deadzone_ZeroActionSmoke_pythoncmd.md)

---

## P2: 出弯回线与速度软约束

**目标**：优化出弯恢复

| 机制 | 作用 |
|------|------|
| 回线奖励 | 仅在 exit window 生效 |
| 速度软约束 | 用曲率可达性惩罚替代硬目标 |

**文档**: [P2_v4.1_出弯回线与速度软约束_pythoncmd.md](file:///c:/Users/wumin/Nutstore/1/DDPG的轨迹平滑/基于强化学习的轨迹平滑/P2_v4.1_出弯回线与速度软约束_pythoncmd.md)

---

## P3: 速度激励与直线高效进给 ⭐ 新增

**目标**：解决全程速度偏低问题

### 核心机制

| 机制 | 公式/说明 |
|------|----------|
| **速度正激励** | $r_{\text{speed}} = +w_v \cdot (v_{\text{exec}} / v_{\max})$ |
| **直线段识别** | `dist_to_turn > threshold && kappa < eps` |
| **直线段速度目标** | `speed_target = 0.95 × v_max` |
| **时间惩罚调优** | 增大 `time_penalty` 逼迫快速完成 |

### 建议权重

| 权重 | P0 值 | P3 建议值 |
|------|-------|-----------|
| w_s | 20.0 | 20.0~25.0 |
| w_e | 5.0 | 3.0~5.0 |
| w_t | 1.0 | 0.5~1.5 |
| **w_v** | 0.0 | **3.0~5.0** |

### 验收标准

- 直线段平均速度 ≥ 0.85 × v_max
- 全程平均速度较 P2 提升 ≥ 20%
- 完成时间较 P2 缩短 ≥ 15%

**文档**: [P3_v4.1_速度激励与直线高效进给.md](file:///c:/Users/wumin/Nutstore/1/DDPG的轨迹平滑/基于强化学习的轨迹平滑/P3_v4.1_速度激励与直线高效进给.md)

---

## 运动学参数待确认

> [!IMPORTANT]
> 用户确认加速度/捷度使用 **mm/min 体系**

请提供以下参数值（mm/min 单位）：

| 参数 | 符号 | 您的值 | 换算为 mm/s |
|------|------|--------|-------------|
| 最大加速度 | $a_{\max}$ | ? mm/min² | ÷3600 |
| 最大加加速度 | $j_{\max}$ | ? mm/min³ | ÷216000 |

---

## 推荐执行顺序

1. ✅ **P0**: 已通过
2. **P1**: 执行 LOS + Deadzone（解决拐角）
3. **P2**: 执行出弯回线 + 速度软约束
4. **P3**: 执行速度激励（解决速度偏低）
5. **验收**: 检查全程速度和拐角圆弧化
