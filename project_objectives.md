# 基于强化学习的 CNC 轨迹平滑优化系统

## 1. 研究背景与问题陈述

### 1.1 研究背景

在计算机数控 (CNC) 加工领域，刀具轨迹的平滑性直接影响加工精度、表面质量和机床运动学性能。传统的轨迹规划方法在处理复杂几何形状（尤其是尖锐拐角）时面临权衡困难：严格跟踪原始轨迹往往需要在拐角处剧烈减速甚至停顿，而追求速度连续性则可能导致轮廓误差超出允许公差。

### 1.2 问题陈述

本研究致力于设计一种基于近端策略优化 (Proximal Policy Optimization, PPO) 的强化学习框架，实现刀具轨迹的智能平滑优化。其核心挑战在于：在给定的轮廓误差容许带 (tolerance band) 约束下，自动规划一条既能保证加工精度、又能最大化进给速度的平滑轨迹。

---

## 2. 系统优化目标

### 2.1 直线进给段优化目标

| 目标维度 | 具体要求 |
|---------|----------|
| **轨迹贴合度** | 训练轨迹应尽可能贴近原始参考轨迹，轮廓误差 $|e| \ll \varepsilon/2$ |
| **速度最大化** | 在满足运动学约束的前提下，使执行速度 $v_{\text{exec}}$ 逼近最大允许速度 $v_{\max}$ |
| **运动平滑性** | 速度曲线连续无跳变，加速度与加加速度 (jerk) 满足约束条件 |

> **注**: $\varepsilon$ 为轮廓误差容许带宽度，$\varepsilon/2$ 为半容许带。

### 2.2 拐角过渡段优化目标

| 目标维度 | 具体要求 |
|---------|----------|
| **拐角识别与前瞻** | 提前检测前方拐角，评估拐角曲率半径 $\rho$ 及与容许带的几何关系 |
| **内切轨迹规划** | 在容许带约束内自动选取最优内切圆弧轨迹，确定入弯点 (entry point) 与出弯点 (exit point) |
| **速度损失最小化** | 圆弧化过弯策略应使速度衰减最小化，即 $\min \Delta v_{\text{corner}}$ |
| **平滑连接** | 入弯与出弯的曲率连续或准连续 ($G^1$ 或 $G^2$ 连接)，避免角加速度尖峰 |

### 2.3 终点可达性目标

| 目标维度 | 具体要求 |
|---------|----------|
| **完整性** | 智能体必须完成全程轨迹，最终进度 $\pi \geq 0.95$（开放路径）或完成闭环（闭合路径） |
| **稳定停止** | 在有效工作区域内稳定减速至终点，无过冲或振荡 |

---

## 3. 系统约束条件

### 3.1 运动学约束（Kinematic Constraint Module, KCM）

| 参数 | 符号 | 当前设定值 | 单位 |
|------|------|-----------|------|
| 插补周期 | $\Delta t$ | 0.001 | s |
| 最大进给速度 | $v_{\max}$ | 5000 | mm/min |
| 最大加速度 | $a_{\max}$ | 待确定 | mm/s² |
| 最大加加速度 | $j_{\max}$ | 待确定 | mm/s³ |
| 最大角速度 | $\omega_{\max}$ | $2\pi$ | rad/s |
| 最大角加速度 | $\dot{\omega}_{\max}$ | $10\pi$ | rad/s² |

### 3.2 几何约束

- **轮廓误差容许带**: 轨迹在任意时刻的横向偏差 $|e(t)| \leq \varepsilon/2$
- **切角约束**: 内切圆弧轨迹必须完全位于容许带内

### 3.3 控制语义

本系统采用 **残差控制 (Residual Control)** 语义：
- 参考方向 $\theta_{\text{ref}}$ 由前瞻机制自动计算
- 智能体输出角速度残差 $\delta\omega$ 对参考方向进行微调
- 执行航向 $\theta_{\text{eff}} = \theta_{\text{ref}} + \delta\omega \cdot \Delta t$

---

## 4. 性能评价指标

### 4.1 主要指标

| 指标 | 符号/计算方式 | 目标阈值 |
|------|--------------|----------|
| 成功率 | $R_{\text{success}}$ | $\geq 80\%$ |
| 平均最终进度 | $\bar{\pi}_{\text{final}}$ | $\geq 95\%$ |
| 最大轮廓误差 | $\max|e|$ | $\leq \varepsilon/2$ |
| 拐角圆弧化程度 | 拐角峰值角加速度降低 | $\geq 30\%$ vs. 基线 |
| 拐角平均速度 | $\bar{v}_{\text{corner}}$ | $\geq 80\%$ vs. 全程平均 |
| 停滞率 | $R_{\text{stall}}$ | $\leq 5\%$ |

### 4.2 辅助指标

- 参考信号连续性: $\max|\Delta\theta_{\text{ref}}| \leq 0.35$ rad/step
- 出弯恢复步数: 相较基线降低 $\geq 30\%$
- 出弯振荡 RMS: 不高于基线 1.10 倍

---

## 5. 当前系统状态分析

### 5.1 已达成目标

| 状态 | 描述 |
|------|------|
| ✅ 终点可达性 | 轨迹能够到达终点，完成全程 |
| ✅ 轨迹贴合 | 智能体沿参考轨迹行进，保持基本贴合 |

### 5.2 待解决问题

| 问题 | 严重程度 | 分析 |
|------|---------|------|
| ⚠️ **拐角尖角化** | 高 | 拐角处未实现圆弧过渡，存在航向突变 |
| ⚠️ **全程速度偏低** | 高 | 执行速度远未达到 $v_{\max} = 5000$ mm/min 的预期 |
| ⚠️ **运动学参数待定** | 中 | 加速度与捷度约束尚未明确配置 |

### 5.3 问题根因推测

1. **拐角尖角问题**: 可能缺乏前瞻机制（Lookahead/LOS）或参考方向提前转向逻辑
2. **速度偏低问题**: 
   - 奖励函数中进度奖励权重不足
   - 可能存在过强的惩罚项抑制速度提升
   - 缺乏速度目标引导机制

---

## 6. 参考文献与术语

| 术语 | 解释 |
|------|------|
| PPO | Proximal Policy Optimization，近端策略优化算法 |
| LOS | Line-of-Sight，视线导引法 |
| Deadzone | 死区，允许小误差不受惩罚的区间 |
| Residual Control | 残差控制，智能体仅输出对参考信号的增量调整 |
| KCM | Kinematic Constraint Module，运动学约束模块 |
| Tolerance Band | 容许带，允许轨迹偏离参考路径的最大范围 |

---

**文档版本**: v1.0  
**创建日期**: 2025-12-26  
**项目代号**: PPO_project
