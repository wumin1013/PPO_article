# Context
现在代码已经修复，基础训练应该正常了。为了解决“不够智能”和“轨迹不平滑”的问题，我们需要引入针对数控加工（CNC）特性的优化策略。

# Task: 实施 PPO 智能增强策略

请基于当前的 `PPO_project` 代码库，生成一份优化补丁：

## 1. 引入“平滑性”奖励 (Action Smoothing)
机床不喜欢剧烈的加速度变化。
- **修改 `reward.py`：** 增加一项 `Smoothness Reward`。
- **逻辑：** 计算当前动作 $a_t$ 与上一时刻动作 $a_{t-1}$ 的差值平方。
- **公式：** $R_{total} = R_{tracking} - \lambda \cdot \| a_t - a_{t-1} \|^2$
- **实现细节：** 你需要在 `cnc_env.py` 中维护 `self.last_action` 变量。

## 2. 观测空间增强：历史帧堆叠 (Frame Stacking)
单帧观测（当前位置+误差）无法让智能体感知“速度”和“加速度”趋势，导致它不知道何时减速。
- **修改方案：** 不修改底层 Env，而是建议在 `main.py` 中使用 `VecFrameStack` 包装器。
- **参数：** 建议堆叠最近 **4帧** (`n_stack=4`)。这能显著提升智能体对曲率变化的预判能力。

## 3. 课程学习配置 (Curriculum Learning)
为了防止智能体在复杂轨迹上直接“摆烂”。
- **修改方案：** 请提供一份分阶段训练的建议流程。
    - **Stage 1:** 仅训练直线 (`Line`)，由简入繁。
    - **Stage 2:** 训练大半径圆弧或正方形 (`Square`)。
    - **Stage 3:** 最后微调蝴蝶形曲线 (`Butterfly`)。

请直接给出修改后的 `src/environment/reward.py` 代码（包含平滑项）和 `main.py` 中添加 `VecFrameStack` 的代码片段。