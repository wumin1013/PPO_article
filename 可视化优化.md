# 优化指令 07：一键启动与动态参数配置系统

## 1. 背景与目标

**现状痛点：** 目前系统已具备强大的后台训练能力，但前端控制权有限。用户在调整核心物理参数（如速度、加速度限制）时，仍需手动修改配置文件。此外，启动过程依赖命令行，不够便捷。

**核心目标：**

1. **参数透传机制：** 在网页端直接修改运动学参数，通过命令行动态覆盖 YAML 配置，实现“零代码”调参。
2. **一键就绪：** 提供双击运行的脚本，自动处理环境激活与服务启动。

## 2. 任务清单 (Task List)

### 任务 A：后端参数解析系统的增强 (`main.py`)

**目标：** 使训练主程序能够识别并优先使用命令行传入的运动学参数，覆盖配置文件中的默认值。

1. **参数接收层 (Argparse):**
   - 在 `main.py` 的参数定义部分，新增一组**可选参数**。
   - 涵盖所有关键运动学约束：`--max_vel`, `--max_acc`, `--max_jerk`, `--max_ang_vel`, `--max_ang_acc`, `--max_ang_jerk`。
   - 类型均设为浮点数 (`float`)，默认值设为 `None` (表示不覆盖)。
2. **配置覆盖逻辑 (Config Override):**
   - 修改配置加载逻辑（`apply_cli_overrides` 函数）。
   - **优先级规则：** 建立 `CLI参数 > YAML配置` 的绝对优先级。
   - **实现逻辑：** 遍历上述新增参数，一旦发现某参数不为 `None`，立即更新内存中配置字典 (`config['kinematic_constraints']`) 的对应键值，并打印日志告知用户“参数已被覆盖”。

### 任务 B：前端交互界面的升级 (`app.py`)

**目标：** 将静态的“配置文件选择”升级为动态的“参数配置面板”。

1. **UI 布局重构 (Step 3 新增):**
   - 在现有的“消融实验设置”下方，新增 **"Step 3: 运动学参数微调"** 区域。
   - 使用 `st.expander` 折叠该区域（默认收起），保持界面整洁。
   - **动态默认值：** 当用户在 Step 1 选择不同的轨迹（如 S形 或 蝴蝶形）时，输入框的默认值应自动从对应的 YAML 文件中读取并刷新，而不是写死固定值。
2. **发射器逻辑适配 (Launcher):**
   - 更新 `launch_training_process` 函数。
   - **参数组装：** 读取前端输入框的数值，将其转换为命令行参数字符串（如 `--max_vel 2.5`）。
   - 将这些参数追加到 `subprocess.Popen` 的命令列表中。
3. **命名系统联动:**
   - (可选优化) 当检测到用户修改了默认参数时，自动在生成的 `experiment_name` 中追加 `_Custom` 后缀，便于后续区分标准实验与自定义实验。

### 任务 C：工程化封装 (One-Click Start)

**目标：** 屏蔽命令行细节。

1. **Windows 启动脚本 (`run_dashboard.bat`):**
   - 编写批处理脚本。
   - 核心动作：设置 Python 路径 -> 运行 Streamlit -> 自动打开浏览器。
   - **细节要求：** 添加 `@echo off` 屏蔽杂乱输出，若运行失败需 `pause` 以便查看报错信息。
2. **Linux/Mac 启动脚本 (`run_dashboard.sh`):**
   - 编写 Shell 脚本。
   - 赋予执行权限 (`chmod +x`)。

## 3. 验收标准 (Definition of Done)

完成上述开发后，请执行以下测试流程：

1. **全流程测试：**
   - 双击启动脚本，浏览器自动弹出。
   - 在界面选择 "S-Shape"，展开 Step 3，将 `Max Vel` 从默认的 `1.0` 修改为 `5.0`。
   - 点击 "Launch Training"。
2. **验证点：**
   - 进入 `saved_models` 目录下最新生成的实验文件夹。
   - 打开该文件夹内的 `config.yaml` 副本。
   - **断言：** 其中的 `MAX_VEL` 值必须是 `5.0`。如果依然是 `1.0`，则任务失败。